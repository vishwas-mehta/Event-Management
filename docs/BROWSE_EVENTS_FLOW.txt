================================================================================
          BROWSE & VIEW EVENTS - COMPLETE FLOW
          Public Access â†’ Role-Based Booking â†’ Backend Protection
================================================================================

================================================================================
PART 1: PAGE ACCESS RULES
================================================================================

WHO CAN ACCESS WHAT:

    /events (Browse Events Page)
    â”œâ”€â”€ âœ… Everyone (public - no login required)
    â””â”€â”€ Shows: All published events

    /events/:id (Event Details Page)
    â”œâ”€â”€ âœ… Everyone (public - no login required)
    â””â”€â”€ Shows: Event details + tickets
        BUT booking button behavior changes based on role


================================================================================
PART 2: BROWSE EVENTS PAGE (/events)
================================================================================

WHAT USER SEES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FILTERS SIDEBAR          â”‚   EVENT CARDS GRID                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” Search            â”‚ â”‚   â”‚ [Image]     â”‚ â”‚ [Image]     â”‚ â”‚ [Image]    â”‚â”‚
â”‚  â”‚ [_______________]    â”‚ â”‚   â”‚ Concert     â”‚ â”‚ Workshop    â”‚ â”‚ Art Show   â”‚â”‚
â”‚  â”‚                      â”‚ â”‚   â”‚ Jul 15      â”‚ â”‚ Jul 20      â”‚ â”‚ Aug 01     â”‚â”‚
â”‚  â”‚ Category: [All â–¼]    â”‚ â”‚   â”‚ FREE        â”‚ â”‚ $49         â”‚ â”‚ $25        â”‚â”‚
â”‚  â”‚                      â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚ â˜ Free events only   â”‚ â”‚                                                 â”‚
â”‚  â”‚ â˜ Has availability   â”‚ â”‚   [1] [2] [3] ... [5]  (Pagination)             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


FRONTEND DATA FLOW:
    1. Component mounts
    2. useEffect â†’ eventsApi.getEvents(filters)
    3. API: GET /api/events?page=1&limit=12
    4. Response: { events: [...], pagination: {...} }
    5. setEvents(response.data.events)
    6. UI renders EventCard for each event


BACKEND (event.controller.ts):
    getEvents = async (req, res) => {
        const { page, limit, search, category } = req.query;
        
        // Build query - only published events
        const query = eventRepository
            .createQueryBuilder('event')
            .where('event.isPublished = :isPublished', { isPublished: true })
            .leftJoinAndSelect('event.category', 'category')
            .leftJoinAndSelect('event.ticketTypes', 'ticketTypes');
        
        // Apply filters...
        // Execute and return
    };


CLICK ON EVENT CARD â†’ Navigate to /events/:id


================================================================================
PART 3: EVENT DETAILS PAGE (/events/:id)
================================================================================

WHAT USER SEES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Banner Image or Video]                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Concert 2024                                                                 â”‚
â”‚  ğŸ“… July 15, 2024 at 6:00 PM                                                 â”‚
â”‚  ğŸ“ Central Park, New York                                                   â”‚
â”‚  ğŸ·ï¸ Music | ğŸ‘¤ Organizer: John Smith                                        â”‚
â”‚                                                                              â”‚
â”‚  DESCRIPTION                                                                  â”‚
â”‚  Amazing summer concert...                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TICKETS                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Regular           FREE            Available: 350/500                   â”‚ â”‚
â”‚  â”‚                                   [Button based on role]               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ VIP (Early Bird)  $49.99          Available: 35/50                     â”‚ â”‚
â”‚  â”‚                   ~~$99.99~~      5 early bird left!                   â”‚ â”‚
â”‚  â”‚                                   [Button based on role]               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
PART 4: ROLE-BASED BUTTON LOGIC (CRITICAL!)
================================================================================

FRONTEND CONDITIONAL RENDERING (EventDetailsPage.tsx):

    {user?.role === UserRole.ATTENDEE ? (
        // ATTENDEE: Can book
        ticket.capacity - ticket.sold > 0 ? (
            <Button onClick={() => handleBookTicket(ticket)}>
                Book Now
            </Button>
        ) : (
            <Button disabled>Sold Out</Button>
        )
    ) : !user ? (
        // NOT LOGGED IN: Redirect to login
        <Button as={Link} to="/login">
            Login to Book
        </Button>
    ) : (
        // ORGANIZER or ADMIN: Cannot book
        <small className="text-muted">Attendees only</small>
    )}


WHAT EACH ROLE SEES:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ROLE          â”‚ BUTTON SHOWN            â”‚ CAN BOOK?            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Not logged in â”‚ [Login to Book]         â”‚ No - redirects       â”‚
    â”‚ Attendee      â”‚ [Book Now]              â”‚ YES                  â”‚
    â”‚ Attendee      â”‚ [Sold Out] (disabled)   â”‚ No - sold out        â”‚
    â”‚ Organizer     â”‚ "Attendees only" text   â”‚ No                   â”‚
    â”‚ Admin         â”‚ "Attendees only" text   â”‚ No                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CODE BREAKDOWN:

    const { user } = useAuth();  // From AuthContext
    
    // Check 1: Is user logged in AND is attendee?
    user?.role === UserRole.ATTENDEE
    
    // Check 2: Is user not logged in?
    !user
    
    // Check 3: Otherwise (organizer/admin)
    // Falls through to "Attendees only"


================================================================================
PART 5: BOOKING FLOW (Attendee Only)
================================================================================

STEP 1: Click "Book Now"
    handleBookTicket(ticket) called
    â†’ Checks if logged in
    â†’ Opens Booking Modal


STEP 2: Booking Modal
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Book Ticket                                            âœ•       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ticket Type: VIP                                               â”‚
â”‚  Price: $49.99                                                  â”‚
â”‚                                                                  â”‚
â”‚  Quantity: [1  â–¼]                                               â”‚
â”‚                                                                  â”‚
â”‚  Total: $49.99                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          [Cancel]  [Confirm Booking]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 3: Confirm Booking
    confirmBooking() called
    â†’ Validates quantity <= available
    â†’ If price > 0: Show Payment Modal
    â†’ If price = 0: Direct booking (doBooking)


STEP 4: Payment Modal (for paid tickets)
    Shows Razorpay-style UI
    User selects payment method
    Click "Pay" â†’ doBooking() called


STEP 5: API Call
    attendeeApi.bookTicket({
        eventId: event.id,
        ticketTypeId: selectedTicket.id,
        quantity: quantity
    });
    
    POST /api/attendee/bookings


================================================================================
PART 6: BACKEND PROTECTION (Double Layer)
================================================================================

LAYER 1: ROUTE MIDDLEWARE (attendee.routes.ts)

    router.use(authenticate, authorize([UserRole.ATTENDEE]));
    router.post('/bookings', attendeeController.bookTicket);
    
    authenticate: Verifies JWT token
    authorize([UserRole.ATTENDEE]): Checks role === 'attendee'
    
    If organizer/admin tries: 403 Forbidden


LAYER 2: CONTROLLER VALIDATION (attendee.controller.ts)

    bookTicket = async (req, res) => {
        const userId = req.user.userId;  // From JWT
        
        // Additional validations
        if (!eventId || !ticketTypeId || !quantity) {
            throw new ValidationError('Missing required fields');
        }
        
        // Check event exists and is published
        const event = await eventRepository.findOne({
            where: { id: eventId }
        });
        if (!event) throw new NotFoundError('Event not found');
        if (!event.isPublished) {
            throw new ValidationError('Event not available');
        }
        
        // Check availability
        const ticketType = await ticketTypeRepository.findOne(...);
        const available = ticketType.capacity - ticketType.sold;
        if (available < quantity) {
            throw new ValidationError(`Only ${available} tickets left`);
        }
        
        // Create booking...
    };


PROTECTION SUMMARY:

    Frontend: Button hidden/disabled for non-attendees
    Route: authenticate + authorize([ATTENDEE])
    Controller: Validates event, availability, quantity
    Database: Transaction + Row locking for race conditions


================================================================================
PART 7: PUBLIC VS PROTECTED ROUTES
================================================================================

PUBLIC ROUTES (No auth required):
    GET /api/events                    â† Browse events
    GET /api/events/:id                â† Event details
    GET /api/events/categories         â† Category list

PROTECTED ROUTES (Attendee only):
    POST /api/attendee/bookings        â† Book ticket
    GET /api/attendee/bookings         â† My bookings
    DELETE /api/attendee/bookings/:id  â† Cancel booking
    POST /api/attendee/events/:id/reviews  â† Write review


FRONTEND: Uses AuthContext to check user role
BACKEND: Uses middleware chain for protection


================================================================================
PART 8: FRONTEND-BACKEND AUTH FLOW
================================================================================

HOW FRONTEND KNOWS USER ROLE:

    1. User logs in â†’ Backend returns JWT + user object
    2. AuthContext stores: { user: { id, email, role }, token }
    3. Every protected API call includes: Authorization: Bearer <token>
    4. Components access: const { user } = useAuth()
    5. Check role: user?.role === UserRole.ATTENDEE


JWT TOKEN CONTENTS:
    {
        userId: "uuid",
        role: "attendee",
        iat: 1705123456,
        exp: 1705209856
    }


AuthContext.tsx:
    export const useAuth = () => {
        const context = useContext(AuthContext);
        return context;  // { user, token, login, logout }
    };


EventDetailsPage.tsx:
    const { user } = useAuth();
    
    // Role check
    if (user?.role === UserRole.ATTENDEE) {
        // Show Book Now button
    }


================================================================================
SUMMARY
================================================================================

BROWSE PAGE:
    âœ… Public - anyone can view
    Shows published events only
    Clicking card â†’ Event Details

EVENT DETAILS PAGE:
    âœ… Public - anyone can view
    Ticket buttons change by role:
        - Guest â†’ "Login to Book"
        - Attendee â†’ "Book Now" or "Sold Out"
        - Organizer/Admin â†’ "Attendees only" text

BOOKING PROTECTION:
    Frontend: Role-based button rendering
    Backend: authenticate + authorize([ATTENDEE]) middleware
    Database: Transactions for race conditions

WHY DOUBLE PROTECTION:
    Frontend: Better UX (don't show unusable buttons)
    Backend: Security (can't bypass with API calls)
    
    Never trust frontend alone! Always enforce on backend.

================================================================================
